---
- name: Create foinq.com HTTPD file directory
  file: 
    path={{ server_file_root }}/foinq.com
    state=directory
    mode=755

- name: Copy across foinq.com Virtual Host
  template: 
    src=foinq.com.conf.j2
    dest=/etc/apache2/sites-available/foinq.com.conf
  notify:
    - reload apache

- name: Copy foinq.com SSL Public Certificate
  copy: 
    src=ssl/foinq.com.crt
    dest={{ server_ssl_root }}/foinq.com.crt
  notify:
    - reload apache

- name: Copy foinq.com SSL Private Key
  copy: 
    src=ssl/foinq.com.key.gitcrypt
    dest={{ server_ssl_root }}/foinq.com.key
  notify:
    - reload apache

- name: Enable foinq.com Virtual Host
  file:
    src=/etc/apache2/sites-available/foinq.com.conf
    dest=/etc/apache2/sites-enabled/foinq.com.conf
    state=link
  notify:
    - reload apache

- name: Clean temporary folder
  shell: rm -rf /tmp/*

- name: Download latest foinq.com code from GitHub
  get_url: 
    url=https://github.com/henrylawson/FoinqWebsite/archive/master.zip
    dest=/tmp/FoinqWebsite-master.zip
    force=yes

- name: Extract latest foinq.com code
  unarchive: 
    src=/tmp/FoinqWebsite-master.zip
    dest=/tmp
    copy=no

- name: Clean foinq.com HTTPD folder
  shell: rm -rf {{ server_file_root }}/foinq.com/*

- name: Copy foinq.com code to HTTPD file
  shell: mv /tmp/FoinqWebsite-master/* {{ server_file_root }}/foinq.com

