<VirtualHost *:80>
  ServerName henrylawson.net
  ServerAlias www.henrylawson.net

  DocumentRoot {{ server_file_root }}/henrylawson.net

  Redirect permanent / https://henrylawson.net/
</VirtualHost>

<VirtualHost _default_:443>
  ServerName henrylawson.net
  ServerAlias www.henrylawson.net

  DirectorySlash Off

  ServerAdmin webmwaster@henrylawson.net
  DocumentRoot {{ server_file_root }}/henrylawson.net
  <Directory {{ server_file_root }}/henrylawson.net>
    Require all granted
  </Directory>

  RewriteEngine On

  # Redirect anything not to top level domain back
  RewriteCond %{HTTP_HOST}  !^henrylawson.net [nocase]
  RewriteRule ^(.*)$        https://henrylawson.net$1 [last,redirect=301]

  # Redirect requests to directories to not have trailing slash
  RewriteCond %{REQUEST_URI} ^(.+)\/
  RewriteRule ^(.*)\/(\?.*)?$ $1$2 [R=301,L]

  # Internally return the "index.html" for directory requests
  RewriteCond %{DOCUMENT_ROOT}%{REQUEST_URI}/index.html -f
  RewriteRule ^(.*)$ /$1/index.html [L]

  # Redirrect index file requests to the directory
  RewriteCond %{REQUEST_URI} ^(.*)/index\.(html|php) [NC]
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^(.*)/index\.(html|php)$ $1 [R=301,L]

  SSLEngine on
  SSLProtocol all -SSLv2
  SSLCipherSuite ALL:!ADH:!EXPORT:!SSLv2:RC4+RSA:+HIGH:+MEDIUM

  SSLCertificateFile      {{ server_ssl_root }}/henrylawson.net.crt
  SSLCertificateKeyFile   {{ server_ssl_root }}/henrylawson.net.key
  SSLCertificateChainFile {{ server_ssl_root }}/sub.class1.server.ca.pem
  SSLCACertificateFile    {{ server_ssl_root }}/startcom.root.ca.pem

  ErrorLog ${APACHE_LOG_DIR}/henrylawson.net-error.log
  CustomLog ${APACHE_LOG_DIR}/henrylawson.net-access.log combined

  ExpiresActive On
  ExpiresByType image/png "access 2 months"
  ExpiresByType image/gif "access 2 months"
  ExpiresByType image/jpeg "access 2 months"
  ExpiresByType text/javascript "access 2 months"
  ExpiresByType text/css "access 2 months"
  ExpiresByType text/html "modification 4 hours"
  ExpiresDefault "access 2 months"

  ErrorDocument 404 /errors/not_found/index.html
  ErrorDocument 401 /errors/not_found/index.html
  ErrorDocument 403 /errors/not_found/index.html
</VirtualHost>
